# Knowledge Finder Bot - Environment Variables
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!

# ============================================================================
# M365 Agents SDK Configuration (Required)
# ============================================================================
# These are required for Microsoft Teams integration
# Get these from Azure Portal > Bot Channels Registration

CONNECTIONS__SERVICE_CONNECTION__SETTINGS__CLIENTID=your-bot-app-id
CONNECTIONS__SERVICE_CONNECTION__SETTINGS__CLIENTSECRET=your-bot-password
CONNECTIONS__SERVICE_CONNECTION__SETTINGS__TENANTID=your-tenant-id

# ============================================================================
# Legacy Environment Variables (Fallback)
# ============================================================================
# These are used by some components that haven't migrated to the new format

MICROSOFT_APP_ID=your-bot-app-id
MICROSOFT_APP_PASSWORD=your-bot-password
MICROSOFT_APP_TENANT_ID=your-tenant-id

# ============================================================================
# Graph API Client Configuration (Required for ACL)
# ============================================================================
# These are required for Azure AD group lookups
# Get these from Azure Portal > App Registrations > [Your Graph API App]
# Required Permissions: User.Read.All, GroupMember.Read.All

GRAPH_CLIENT_ID=your-graph-api-app-id
GRAPH_CLIENT_SECRET=your-graph-api-secret

# ============================================================================
# ACL Configuration (Optional)
# ============================================================================
# Path to ACL YAML configuration file
# Default: config/acl.yaml

ACL_CONFIG_PATH=config/acl.yaml

# ============================================================================
# Graph API Cache Settings (Optional)
# ============================================================================
# Time-to-live for cached user info (seconds)
# Default: 300 (5 minutes)

GRAPH_CACHE_TTL=300

# Maximum number of users to cache
# Default: 1000

GRAPH_CACHE_MAXSIZE=1000

# ============================================================================
# TEST MODE (For Agent Playground Testing)
# ============================================================================
# Enable test mode to use MockGraphClient instead of real Graph API
# This allows testing ACL logic in Agent Playground without Azure AD
# Default: false

TEST_MODE=false

# Comma-separated list of Azure AD group Object IDs to simulate
# Only used when TEST_MODE=true
# Example test groups (from config/acl.yaml):
#   - Test Admin Group:       11111111-1111-1111-1111-111111111111
#   - Test HR Group:          22222222-2222-2222-2222-222222222222
#   - Test Engineering Group: 33333333-3333-3333-3333-333333333333

TEST_USER_GROUPS=

# ============================================================================
# TEST MODE EXAMPLES (Uncomment to use)
# ============================================================================

# Example 1: Test Admin Access (access to ALL notebooks)
# TEST_MODE=true
# TEST_USER_GROUPS=11111111-1111-1111-1111-111111111111

# Example 2: Test HR Access (hr-notebook + public only)
# TEST_MODE=true
# TEST_USER_GROUPS=22222222-2222-2222-2222-222222222222

# Example 3: Test Engineering Access (engineering-notebook + public only)
# TEST_MODE=true
# TEST_USER_GROUPS=33333333-3333-3333-3333-333333333333

# Example 4: Test Multiple Groups (hr + engineering + public)
# TEST_MODE=true
# TEST_USER_GROUPS=22222222-2222-2222-2222-222222222222,33333333-3333-3333-3333-333333333333

# Example 5: Test No Groups (public notebook only)
# TEST_MODE=true
# TEST_USER_GROUPS=

# ============================================================================
# nlm-proxy Configuration (Optional)
# ============================================================================
# URL and API key for the nlm-proxy OpenAI-compatible endpoint
# When not configured, bot falls back to echo mode

NLM_PROXY_URL=
NLM_PROXY_API_KEY=

# Model name for nlm-proxy (default: knowledge-finder)
NLM_MODEL_NAME=knowledge-finder

# Request timeout in seconds (default: 60)
NLM_TIMEOUT=60

# Session (multi-turn conversation) settings
# TTL in seconds (default: 86400 = 24 hours)
NLM_SESSION_TTL=86400
# Max concurrent sessions cached (default: 1000)
NLM_SESSION_MAXSIZE=1000

# ============================================================================
# Server Configuration
# ============================================================================

# Server host
# Default: 0.0.0.0 (all interfaces)

HOST=0.0.0.0

# Server port
# Default: 3978

PORT=3978

# Logging level
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Default: INFO

LOG_LEVEL=INFO

# Log file path (empty = console only)
# When set, logs are written to both console and this file with rotation
# Example: logs/bot.log
# Default: "" (disabled)

LOG_FILE=

# Max log file size in bytes before rotation
# Default: 10485760 (10 MB)

LOG_FILE_MAX_BYTES=10485760

# Number of rotated backup files to keep
# Default: 5

LOG_FILE_BACKUP_COUNT=5

# ============================================================================
# QUICK START FOR AGENT PLAYGROUND TESTING
# ============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Fill in bot credentials (CONNECTIONS__SERVICE_CONNECTION__SETTINGS__*)
# 3. Enable test mode:
#      TEST_MODE=true
#      TEST_USER_GROUPS=22222222-2222-2222-2222-222222222222
# 4. Run bot: uv run python -m knowledge_finder_bot.main
# 5. Run Agent Playground: m365agentsplayground -e https://localhost:3978/api/messages -c emulator
# 6. Test different ACL scenarios by changing TEST_USER_GROUPS
# ============================================================================
